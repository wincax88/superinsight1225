{
  "envId": "${env.TCB_ENV_ID}",
  "region": "ap-shanghai",
  "framework": {
    "name": "superinsight-platform",
    "plugins": {
      "container": {
        "use": "@cloudbase/framework-plugin-container",
        "inputs": {
          "serviceName": "superinsight-fullstack",
          "servicePath": "/",
          "description": "SuperInsight Full-Stack Container (FastAPI + Label Studio + PostgreSQL + Redis)",
          "dockerfilePath": "./deploy/tcb/Dockerfile.fullstack",
          "buildDir": ".",
          "containerPort": 8000,
          "cpu": 2,
          "mem": 2048,
          "minNum": 1,
          "maxNum": 10,
          "policyType": "cpu",
          "policyThreshold": 70,
          "envVariables": {
            "ENVIRONMENT": "${env.ENVIRONMENT}",
            "DEBUG": "${env.DEBUG}",
            "LOG_LEVEL": "${env.LOG_LEVEL}",
            "POSTGRES_USER": "${env.POSTGRES_USER}",
            "POSTGRES_PASSWORD": "${env.POSTGRES_PASSWORD}",
            "POSTGRES_DB": "${env.POSTGRES_DB}",
            "SECRET_KEY": "${env.SECRET_KEY}",
            "JWT_SECRET_KEY": "${env.JWT_SECRET_KEY}",
            "HUNYUAN_API_KEY": "${env.HUNYUAN_API_KEY}",
            "HUNYUAN_SECRET_KEY": "${env.HUNYUAN_SECRET_KEY}",
            "COS_SECRET_ID": "${env.COS_SECRET_ID}",
            "COS_SECRET_KEY": "${env.COS_SECRET_KEY}",
            "COS_REGION": "${env.COS_REGION}",
            "COS_BUCKET": "${env.COS_BUCKET}"
          },
          "volumeMounts": {
            "/var/lib/postgresql/14/main": {
              "name": "postgres-data",
              "readOnly": false
            },
            "/var/lib/redis": {
              "name": "redis-data",
              "readOnly": false
            },
            "/app/label-studio-data": {
              "name": "label-studio-data",
              "readOnly": false
            },
            "/app/uploads": {
              "name": "uploads",
              "readOnly": false
            },
            "/app/logs": {
              "name": "logs",
              "readOnly": false
            }
          },
          "customLogs": {
            "enabled": true
          },
          "isPublic": true,
          "flowRatio": 100,
          "initialDelaySeconds": 60
        }
      }
    }
  },
  "functionRoot": "./",
  "functions": [
    {
      "name": "data-extractor",
      "timeout": 300,
      "runtime": "Python3.11",
      "memorySize": 1024,
      "handler": "src.extractors.api.main",
      "envVariables": {
        "DATABASE_URL": "${env.DATABASE_URL}",
        "REDIS_URL": "${env.REDIS_URL}"
      },
      "triggers": [
        {
          "name": "httpTrigger",
          "type": "http",
          "config": {
            "authType": "FUNCTION",
            "methods": ["GET", "POST", "PUT", "DELETE"]
          }
        }
      ]
    },
    {
      "name": "ai-annotator",
      "timeout": 600,
      "runtime": "Python3.11",
      "memorySize": 2048,
      "handler": "src.ai.factory.main",
      "envVariables": {
        "DATABASE_URL": "${env.DATABASE_URL}",
        "REDIS_URL": "${env.REDIS_URL}",
        "HUNYUAN_API_KEY": "${env.HUNYUAN_API_KEY}",
        "HUNYUAN_SECRET_KEY": "${env.HUNYUAN_SECRET_KEY}"
      },
      "triggers": [
        {
          "name": "httpTrigger",
          "type": "http",
          "config": {
            "authType": "FUNCTION",
            "methods": ["POST"]
          }
        }
      ]
    },
    {
      "name": "quality-manager",
      "timeout": 180,
      "runtime": "Python3.11",
      "memorySize": 512,
      "handler": "src.quality.manager.main",
      "envVariables": {
        "DATABASE_URL": "${env.DATABASE_URL}",
        "REDIS_URL": "${env.REDIS_URL}"
      },
      "triggers": [
        {
          "name": "httpTrigger",
          "type": "http",
          "config": {
            "authType": "FUNCTION",
            "methods": ["POST", "PUT"]
          }
        }
      ]
    }
  ],
  "storage": {
    "rules": [
      {
        "resource": "*",
        "allow": true
      }
    ]
  }
}
