# SuperInsight TCB Secrets Template
# This file documents all required secrets for TCB deployment
# DO NOT commit actual secret values to version control

# =============================================================================
# Required GitHub Secrets
# =============================================================================
# These secrets must be configured in your GitHub repository settings
# (Settings -> Secrets and variables -> Actions)

github_secrets:
  # TCB Authentication
  - name: TCB_ENV_ID
    description: "TCB environment ID for production"
    required: true
    example: "env-xxxxxxxxxx"

  - name: TCB_STAGING_ENV_ID
    description: "TCB environment ID for staging"
    required: true
    example: "env-yyyyyyyyyy"

  - name: TCB_SECRET_ID
    description: "Tencent Cloud SecretId for API authentication"
    required: true
    link: "https://console.cloud.tencent.com/cam/capi"

  - name: TCB_SECRET_KEY
    description: "Tencent Cloud SecretKey for API authentication"
    required: true
    sensitive: true

  - name: TCB_KEY_FILE
    description: "JSON key file content for CloudBase CLI authentication"
    required: true
    format: "JSON"
    example: |
      {
        "secretId": "xxx",
        "secretKey": "yyy"
      }

  # Database Secrets
  - name: POSTGRES_USER
    description: "PostgreSQL username for production"
    required: true
    default: "superinsight"

  - name: POSTGRES_PASSWORD
    description: "PostgreSQL password for production"
    required: true
    sensitive: true
    min_length: 16
    requirements:
      - "At least 16 characters"
      - "Mixed case letters"
      - "Numbers"
      - "Special characters"

  - name: STAGING_POSTGRES_USER
    description: "PostgreSQL username for staging"
    required: true

  - name: STAGING_POSTGRES_PASSWORD
    description: "PostgreSQL password for staging"
    required: true
    sensitive: true

  # Application Secrets
  - name: SECRET_KEY
    description: "FastAPI application secret key"
    required: true
    sensitive: true
    min_length: 32
    generation: "openssl rand -hex 32"

  - name: JWT_SECRET_KEY
    description: "JWT signing secret key"
    required: true
    sensitive: true
    min_length: 32
    generation: "openssl rand -hex 32"

  # AI Service Secrets
  - name: HUNYUAN_API_KEY
    description: "Hunyuan AI API key"
    required: true
    link: "https://console.cloud.tencent.com/hunyuan"

  - name: HUNYUAN_SECRET_KEY
    description: "Hunyuan AI secret key"
    required: true
    sensitive: true

  # Object Storage Secrets
  - name: COS_SECRET_ID
    description: "Tencent COS SecretId"
    required: true

  - name: COS_SECRET_KEY
    description: "Tencent COS SecretKey"
    required: true
    sensitive: true

  - name: COS_BUCKET
    description: "COS bucket name"
    required: true
    example: "superinsight-prod-xxxxxxxxxx"

  # Optional Secrets
  - name: CODECOV_TOKEN
    description: "Codecov upload token for test coverage"
    required: false
    link: "https://codecov.io"

# =============================================================================
# TCB Environment Variables (Configured via TCB Console)
# =============================================================================
tcb_environment_variables:
  production:
    - ENVIRONMENT: "production"
    - DEBUG: "false"
    - LOG_LEVEL: "WARNING"
    - APP_HOST: "0.0.0.0"
    - APP_PORT: "8000"
    - POSTGRES_HOST: "localhost"
    - POSTGRES_PORT: "5432"
    - POSTGRES_DB: "superinsight"
    - REDIS_HOST: "localhost"
    - REDIS_PORT: "6379"
    - PROMETHEUS_ENABLED: "true"

  staging:
    - ENVIRONMENT: "staging"
    - DEBUG: "false"
    - LOG_LEVEL: "INFO"
    - APP_HOST: "0.0.0.0"
    - APP_PORT: "8000"
    - POSTGRES_HOST: "localhost"
    - POSTGRES_PORT: "5432"
    - POSTGRES_DB: "superinsight_staging"
    - REDIS_HOST: "localhost"
    - REDIS_PORT: "6379"
    - PROMETHEUS_ENABLED: "true"

# =============================================================================
# Secret Rotation Policy
# =============================================================================
rotation_policy:
  database_passwords:
    interval: "90 days"
    notification: "14 days before expiry"

  api_keys:
    interval: "180 days"
    notification: "30 days before expiry"

  jwt_secrets:
    interval: "365 days"
    notification: "30 days before expiry"

# =============================================================================
# Secret Validation Script
# =============================================================================
validation_script: |
  #!/bin/bash
  # Run this script to validate all required secrets are set

  REQUIRED_SECRETS=(
    "TCB_ENV_ID"
    "TCB_SECRET_ID"
    "TCB_SECRET_KEY"
    "POSTGRES_PASSWORD"
    "SECRET_KEY"
    "JWT_SECRET_KEY"
    "HUNYUAN_API_KEY"
    "HUNYUAN_SECRET_KEY"
    "COS_SECRET_ID"
    "COS_SECRET_KEY"
  )

  echo "Validating required environment variables..."
  MISSING=0

  for secret in "${REQUIRED_SECRETS[@]}"; do
    if [ -z "${!secret}" ]; then
      echo "ERROR: Missing required secret: $secret"
      MISSING=$((MISSING + 1))
    else
      echo "OK: $secret is set"
    fi
  done

  if [ $MISSING -gt 0 ]; then
    echo ""
    echo "ERROR: $MISSING required secrets are missing!"
    exit 1
  fi

  echo ""
  echo "All required secrets are configured."
  exit 0
